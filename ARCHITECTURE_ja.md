# アーキテクチャ: コア機能とシェル統合の分離

本プロジェクトは、コアロジックを担当する **`alt-z` コマンド** と、それをシェルから利用するための **シェル統合スクリプト** の2層で構成されます。

## 1. `alt-z` コマンド (Core)

**「ディレクトリ移動履歴の管理と検索」** というコア機能を提供する独立したコマンドラインツールです。
実装言語（Python）は隠蔽され、外部からは単一の実行可能ファイルとして振る舞います。

### コマンド体系
`alt-z <subcommand> [options] [args]`

*   **`add <path>`**: 指定されたパスを履歴に追加・更新します。
*   **`query <args>...`**: 履歴からパスを検索し、結果を標準出力に返します。
    *   デフォルトでは Frecency アルゴリズムを使用。
    *   `-l`: リスト表示。
    *   `-e`: 最適なマッチを1行で表示（`cd` 用）。
*   **`clean`**: 存在しないディレクトリの削除など、メンテナンスを行います。

## 2. シェル統合 (Shell Integration)

ユーザーが日常的に利用するインターフェース（`az` コマンドやフック）を提供します。
`alt-z` コマンドの仕様に依存しますが、その内部実装（Pythonなど）には依存しません。

### 責務
1.  **フック**: シェルのプロンプト表示時などに `az add` (内部で `alt-z add`) を呼び出し、移動履歴を自動記録する。
2.  **エイリアス/関数**: `az` コマンドを定義し、ユーザー入力を受け取る。
3.  **移動の実行**: `az query` (内部で `alt-z query`) の結果を受け取り、シェル自身の機能（`cd`）を実行する。

## 3. データフロー

```mermaid
graph TD
    User[User / Shell Hook] -->|Call| Shell[Shell Integration (az.sh / az command)]
    
    Shell -->|Exec| AltZ[alt-z Command]
    
    subgraph Core Logic
        AltZ -->|Read/Write| DB[(Data File)]
    end
    
    AltZ -->|Result Path| Shell
    Shell -->|cd| CurrentDir[Current Directory]
```

## 4. 設計のメリット
*   **疎結合**: コアロジックを別の言語（RustやGoなど）で書き直しても、インターフェース（CLI仕様）さえ守ればシェル統合スクリプトは修正不要。
*   **テスト容易性**: `alt-z` コマンド単体でロジックのテストが完結する。
*   **移植性**: シェル統合部分は非常に薄くなるため、FishやPowerShellなど他のシェルへの対応が容易。
